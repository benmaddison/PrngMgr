{% extends "prngmgr/base.html" %}
{% load staticfiles %}

{% block scripts %}
    <script type="text/javascript" charset="utf-8">
        $(document).ready( function () {
            var classes = {
                'Provisioning': "#2d9bd2",
                'Admin Down': "#e8c517",
                'Down': "#b84747",
                'Up': "#67b847"
            };
            var summary = $.getJSON("/api/session/status_summary/");
            var pie = Plotly.d3.select('#pie').node();
            var margin = 30;
            var layout = {
                margin: {t: margin, b: margin, l: margin, r: margin}
            };
            summary.done( function (response) {
                var values = [];
                var labels = [];
                var colors = [];
                for (i in response) {
                    var label = response[i].label;
                    if (label != "None") {
                        labels.push(label);
                        values.push(response[i].value);
                        colors.push(classes[label]);
                    }
                }
                var data = {
                    showlegend: false,
                    hole: 0.2,
                    marker: {
                        colors: colors,
                        line: {color: "#fff" ,width: 2}
                    },
                    values: values,
                    labels: labels,
                    textinfo: "value",
                    type: 'pie'
                };
                Plotly.newPlot(pie, [data], layout);
            });
        })
    </script>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            <div class="jumbotron">
                <div class="row">
                    <div class="col-md-3">
                        <img class="img-rounded img-responsive center-block" src="{% static 'img/logo_sqr.jpg' %}"/>
                    </div>
                    <div class="col-md-9">
                        <h1>Welcome to Peering Manager</h1>
                        {% if me %}
                            <p class="lead">We are {{ me.name }}, AS{{ me.asn }}</p>
                        {% else %}
                            <p>Can't find our PDB record. Please check prngmgr/local_settings.py</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <h2>Session State</h2>
            <div id="pie" style="width: 100%; height: 100%"></div>
        </div>
        <div class="col-md-8">
            <h2>Down Sessions</h2>
            <table id="down-sessions-table" class="table nowrap" cellpadding="0" width="100%">
                <thead></thead>
            </table>
        </div>
    </div>
{% endblock %}